<!DOCTYPE html>
<html lang="en-us" />
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

    <title>Ebola simulation part 1: early outbreak assessment &middot; </title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="https://reconlearn-ld.netlify.com/favicon.ico" />
    <link rel="canonical" href="https://reconlearn-ld.netlify.com/post/simulated-evd-early.html" />

     <meta name="description" content="This practical simulates the early assessment and reconstruction of an Ebola Virus Disease (EVD) outbreak. It introduces various aspects of analysis of the earl" /> 

     
    
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:image" content="https://reconlearn-ld.netlify.com/img/highres/ebola.jpg"/>
    
 
    <meta name="twitter:title" content="Ebola simulation part 1: early outbreak assessment"/>
    <meta name="twitter:description" content="This practical simulates the early assessment and reconstruction of an Ebola Virus Disease (EVD) outbreak. It introduces various aspects of analysis of the earl"/>
    <meta name="twitter:url" content="https://reconlearn-ld.netlify.com/post/simulated-evd-early.html" />
    <meta name="twitter:site" content="@teebzr"/>

    <meta property="og:site_name" content="" />
    <meta property="og:title" content="Ebola simulation part 1: early outbreak assessment &middot; RECON learn" />
    <meta property="og:url" content="https://reconlearn-ld.netlify.com/post/simulated-evd-early.html" />
    

    <meta property="og:type" content="article" />
    <meta property="og:description" content="This practical simulates the early assessment and reconstruction of an Ebola Virus Disease (EVD) outbreak. It introduces various aspects of analysis of the earl" />

    <meta property="article:published_time" content="2017-12-09T00:00:00Z" />
    

    <meta property="og:image" content="https://reconlearn-ld.netlify.com/img/highres/ebola.jpg"/>


    <meta name="generator" content="Hugo 0.41" />

    <!-- Stylesheets -->
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-oi8o31xSQq8S0RpBcb4FaLB8LJi9AT8oIdmS1QldR8Ui7KUQjNAnDlJjp55Ba8FG" crossorigin="anonymous">
	<link rel="stylesheet" type="text/css" href="https://reconlearn-ld.netlify.com/built/screen.css" /> 
    <link rel="stylesheet" type="text/css" href="https://reconlearn-ld.netlify.com/css/casper-two.css" /> 
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css" />
     <link rel="stylesheet" href="https://reconlearn-ld.netlify.com/css/custom.css" /> 

     

<script src="//yihui.name/js/math-code.js"></script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

</head>


<body class="post-template">
  <div class="site-wrapper"> 

<header class="site-header outer">
  <div class="inner">
    <nav class="site-nav">
      <div class="site-nav-left">
        <a class="site-nav-logo" href="/"><img src="https://reconlearn-ld.netlify.com/img/logo/learnBlueAndWhite.png" alt="RECON learn" /></a>

        <ul class="nav" role="menu">
        
        
        
            <li class="" role="menuitem">
              <a href="/"> Home</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/categories/lectures.html"><i class='far fa-align-justify'></i> Lectures</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/categories/practicals.html"><i class='far fa-align-justify'></i> Practicals</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/authors.html"><i class='far fa-align-justify'></i> Authors</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/topics.html"><i class='far fa-align-justify'></i> Topics</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/licenses.html"><i class='far fa-align-justify'></i> Licenses</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/about.html"> About</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/contact.html"> Contact</a>
            </li>
        
            <li class="" role="menuitem">
              <a href="/sample.html"> Sample</a>
            </li>
        
      </ul></div>

      <div class="site-nav-right">
        <div class="social-links">
                    

                    <a class="social-link social-link-tw" href="https://twitter.com/teebzr" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg></a>

                    <a class="social-link" href="https://github.com/reconhub/learn" target="_blank" rel="noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>

                    

                    
        </div>  
            
      </div>

    </nav>  

  </div>
</header>

<main id="site-main" class="site-main outer" role="main">
  <div class="inner">
    
      <article class="post-full post"> 
        <header class="post-full-header">
            <h1 class="post-full-title">Ebola simulation part 1: early outbreak assessment</h1>
            <section class="post-full-meta">
                <time class="post-full-meta-date" datetime="2017-12-09">9 December 2017</time>
                <span class="date-divider">/</span>
                
    <a href="/categories/.html">[practicals]</a> &nbsp;
  
            
                
                <span class="date-divider">/</span> <a href="https://reconlearn-ld.netlify.com/topics/simulation.html">#simulation</a>&nbsp;<a href="https://reconlearn-ld.netlify.com/topics/response.html">#response</a>&nbsp;<a href="https://reconlearn-ld.netlify.com/topics/ebola.html">#Ebola</a>&nbsp;<a href="https://reconlearn-ld.netlify.com/topics/epicurve.html">#epicurve</a>&nbsp;<a href="https://reconlearn-ld.netlify.com/topics/reproduction-number.html">#reproduction number</a>&nbsp;
            </section>
        </header>
        
         
        <section class="post-full-content">
                <div class="kg-card-markdown">
                

<p>This practical simulates the early assessment and reconstruction of an
Ebola Virus Disease (EVD) outbreak. It introduces various aspects of
analysis of the early stage of an outbreak, including contact tracing
data, epicurves, growth rate estimation from log-linear models, and more
refined estimates of transmissibility. A follow-up practical will
provide an introduction to transmission chain reconstruction using
<em>outbreaker2</em>.</p>

<p><br></p>

<h1 id="a-novel-evd-outbreak-in-ankh-republic-of-morporkia">A novel EVD outbreak in Ankh, Republic of Morporkia</h1>

<p>A new EVD outbreak has been notified in the small city of Ankh, located
in the Northern, rural district of the Republic of Morporkia. Public
Health Morporkia (PHM) is in charge of coordinating the outbreak
response, and have contracted you as a consultant in epidemics analysis
to inform the response in real time.</p>

<h2 id="required-packages">Required packages</h2>

<p>The following packages, available on CRAN, are needed for this case
study:</p>

<ul>
<li><a href="https://cran.r-project.org/web/packages/xlsx/index.html"><code>xlsx</code></a> to
read <code>.xlsx</code> files</li>
<li><a href="http://www.repidemicsconsortium.org/outbreaks/"><code>outbreaks</code></a> for
some other outbreak data</li>
<li><a href="http://www.repidemicsconsortium.org/incidence/"><code>incidence</code></a> for
epicurves</li>
<li><a href="http://www.repidemicsconsortium.org/epicontacts/"><code>epicontacts</code></a>
for contact data visualisation</li>
<li><a href="http://www.repidemicsconsortium.org/distcrete"><code>distcrete</code></a> to
obtain discretised delay distributions</li>
<li><a href="http://www.repidemicsconsortium.org/epitrix"><code>epitrix</code></a> to fit
discretised Gamma distributions</li>
<li><a href="http://www.repidemicsconsortium.org/earlyR"><code>earlyR</code></a> to estimate
<em>R</em><sub>0</sub></li>
<li><a href="http://www.repidemicsconsortium.org/projections"><code>projections</code></a> for
short term forecasting</li>
</ul>

<p>To install these packages, use <code>install.packages</code>, e.g.:</p>

<pre><code class="language-r">install.packages(&quot;xlsx&quot;)
install.packages(&quot;outbreaks&quot;)
install.packages(&quot;incidence&quot;)
install.packages(&quot;epicontacts&quot;)
install.packages(&quot;distcrete&quot;)
install.packages(&quot;epitrix&quot;)
install.packages(&quot;earlyR&quot;)
install.packages(&quot;projections&quot;)
</code></pre>

<h2 id="early-data">Early data</h2>

<p>While a new data update is pending, you have been given the following
linelist and contact data, from the early stages of the outbreak:</p>

<ul>
<li><p><a href="../../data/PHM-EVD-linelist-2017-10-27.xlsx">PHM-EVD-linelist-2017-10-27.xlsx</a>:
a linelist containing case information up to the 27th October 2017</p></li>

<li><p><a href="../../data/PHM-EVD-contacts-2017-10-27.xlsx">PHM-EVD-contacts-2017-10-27.xlsx</a>:
a list of contacts reported between cases up to the 27th October
2017, where <code>from</code> indicates a potential source of infection, and
<code>to</code> the recipient of the contact.</p></li>
</ul>

<p>To read into R, download these files and use the function <code>read.xlsx()</code>
from the <code>xlsx</code> package to import the data. Each import will create a
<code>data.frame</code>. Call the first one <code>linelist</code>, and the second one
<code>contacts</code>. For instance, you first command line could look like:</p>

<pre><code class="language-r">linelist &lt;- xlsx::read.xlsx(&quot;PHM-EVD-linelist-2017-10-27.xlsx&quot;, sheetIndex = 1)
</code></pre>

<p>Once imported, the data should look like:</p>

<pre><code class="language-r">
## linelist: one line per case
linelist
##        id      onset    sex age
## 1  39e9dc 2017-10-10 female  62
## 2  664549 2017-10-16   male  28
## 3  b4d8aa 2017-10-17   male  54
## 4  51883d 2017-10-18   male  57
## 5  947e40 2017-10-20 female  23
## 6  9aa197 2017-10-20 female  66
## 7  e4b0a2 2017-10-21 female  13
## 8  af0ac0 2017-10-21   male  10
## 9  185911 2017-10-21 female  34
## 10 601d2e 2017-10-22   male  11
## 11 605322 2017-10-22 female  23
## 12 e399b1 2017-10-23 female  23

## contacts: pairs of cases with reported contacts
contacts
##      from     to
## 1  51883d 185911
## 2  b4d8aa e4b0a2
## 3  39e9dc b4d8aa
## 4  39e9dc 601d2e
## 5  51883d 9aa197
## 6  39e9dc 51883d
## 7  39e9dc e399b1
## 8  b4d8aa af0ac0
## 9  39e9dc 947e40
## 10 39e9dc 664549
## 11 39e9dc 605322
</code></pre>

<h1 id="descriptive-analyses">Descriptive analyses</h1>

<h2 id="a-first-look-at-contacts">A first look at contacts</h2>

<p>Contact tracing is at the centre of an Ebola outbreak response. Using
the function <code>make_epicontacts</code> in the <code>epicontacts</code> package, create a
new <code>epicontacts</code> object called <code>x</code>. The result should look like:</p>

<pre><code class="language-r">x
## 
## /// Epidemiological Contacts //
## 
##   // class: epicontacts
##   // 12 cases in linelist; 11 contacts;  directed 
## 
##   // linelist
## 
## # A tibble: 12 x 4
##    id     onset      sex      age
##  * &lt;chr&gt;  &lt;date&gt;     &lt;fct&gt;  &lt;dbl&gt;
##  1 39e9dc 2017-10-10 female   62.
##  2 664549 2017-10-16 male     28.
##  3 b4d8aa 2017-10-17 male     54.
##  4 51883d 2017-10-18 male     57.
##  5 947e40 2017-10-20 female   23.
##  6 9aa197 2017-10-20 female   66.
##  7 e4b0a2 2017-10-21 female   13.
##  8 af0ac0 2017-10-21 male     10.
##  9 185911 2017-10-21 female   34.
## 10 601d2e 2017-10-22 male     11.
## 11 605322 2017-10-22 female   23.
## 12 e399b1 2017-10-23 female   23.
## 
##   // contacts
## 
## # A tibble: 11 x 2
##    from   to    
##    &lt;chr&gt;  &lt;chr&gt; 
##  1 51883d 185911
##  2 b4d8aa e4b0a2
##  3 39e9dc b4d8aa
##  4 39e9dc 601d2e
##  5 51883d 9aa197
##  6 39e9dc 51883d
##  7 39e9dc e399b1
##  8 b4d8aa af0ac0
##  9 39e9dc 947e40
## 10 39e9dc 664549
## 11 39e9dc 605322
</code></pre>

<p>You can easily plot these contacts, but with a little bit of tweaking
(see <code>?vis_epicontacts</code>) you can customise shapes by gender:</p>

<pre><code class="language-r">plot(x, node_shape = &quot;sex&quot;, shapes = c(male = &quot;male&quot;, female = &quot;female&quot;), selector = FALSE)
</code></pre>

<p><img src="practical-ebola-response_files/figure-markdown_github/epicontacts_plot-1.png" alt="" /></p>

<p><font class="question">What can you say about these contacts?</font></p>

<h2 id="looking-at-incidence-curves">Looking at incidence curves</h2>

<p>The first question PHM asks you is simply: <em>how bad is it?</em>. Given that
this is a terrible disease, with a mortality rate nearing 70%, there is
a lot of concern about this outbreak getting out of control. The first
step of the analysis lies in drawing an <em>epicurve</em>, i.e. an plot of
incidence over time.</p>

<p><br></p>

<p>Using the package <code>incidence</code>, compute daily incidence based on the
dates of symptom onset. Store the result in an object called <code>i</code>; the
result should look like:</p>

<pre><code class="language-r">i
## &lt;incidence object&gt;
## [12 cases from days 2017-10-10 to 2017-10-23]
## 
## $counts: matrix with 14 rows and 1 columns
## $n: 12 cases in total
## $dates: 14 dates marking the left-side of bins
## $interval: 1 day
## $timespan: 14 days
plot(i)
</code></pre>

<p><img src="practical-ebola-response_files/figure-markdown_github/incidence-1.png" alt="" /></p>

<p>If you pay close attention to the dates on the x-axis, you may notice
that something is missing. Indeed, the graph stops right after the last
case, while the data should be complete until the 27th October 2017. You
can remedy this using the argument <code>last_date</code> in the <code>incidence</code>
function:</p>

<pre><code class="language-r">i &lt;- incidence(linelist$onset, last_date = as.Date(&quot;2017-10-27&quot;))
i
## &lt;incidence object&gt;
## [12 cases from days 2017-10-10 to 2017-10-27]
## 
## $counts: matrix with 18 rows and 1 columns
## $n: 12 cases in total
## $dates: 18 dates marking the left-side of bins
## $interval: 1 day
## $timespan: 18 days
plot(i)
</code></pre>

<p><img src="practical-ebola-response_files/figure-markdown_github/incidence_rectif-1.png" alt="" /></p>

<h1 id="statistical-analyses">Statistical analyses</h1>

<h2 id="log-linear-model">Log-linear model</h2>

<p>The simplest model of incidence is probably the log-linear model, i.e. a
linear regression on log-transformed incidences. In the <code>incidence</code>
package, the function <code>fit</code> will estimate the parameters of this model
from an incidence object (here, <code>i</code>). Apply it to the data and store the
result in a new object called <code>f</code>. You can print <code>f</code> to derive estimates
of the growth rate <em>r</em> and the doubling time, and add the corresponding
model to the incidence plot:</p>

<pre><code class="language-r">f &lt;- fit(i)
## Warning in fit(i): 10 dates with incidence of 0 ignored for fitting
f
## &lt;incidence_fit object&gt;
## 
## $lm: regression of log-incidence over time
## 
## $info: list containing the following items:
##   $r (daily growth rate):
## [1] 0.05352107
## 
##   $r.conf (confidence interval):
##           2.5 %    97.5 %
## [1,] -0.0390633 0.1461054
## 
##   $doubling (doubling time in days):
## [1] 12.95092
## 
##   $doubling.conf (confidence interval):
##         2.5 %    97.5 %
## [1,] 4.744158 -17.74421
## 
##   $pred: data.frame of incidence predictions (8 rows, 5 columns)
plot(i, fit = f)
</code></pre>

<p><img src="practical-ebola-response_files/figure-markdown_github/fit-1.png" alt="" /></p>

<p><font class="question">How would you interpret this result?What
criticism would you make on this model?</font></p>

<!-- As an aid for interpretation, you are reminded of previous observations of the -->

<!-- serial interval distribution, estimated during the West African EVD outbreak -->

<!-- (WHO Ebola Response Team (2014) NEJM 371:1481â€“1495) with a mean of 15.3 days and -->

<!-- a standard deviation 9.3 days. -->

<h2 id="estimation-of-transmissibility-r">Estimation of transmissibility (<em>R</em>)</h2>

<h3 id="branching-process-model">Branching process model</h3>

<p>The transmissibility of the disease can be assessed through the
estimation of the reproduction number <em>R</em>, defined as the number of
expected secondary cases per infected case. In the early stages of an
outbreak, and assuming no immunity in the population, this quantity is
also the basic reproduction number <em>R</em><sub>0</sub>, i.e. <em>R</em> in a fully
susceptible population.</p>

<p><br></p>

<p>The package <code>earlyR</code> implements a simple maximum-likelihood estimation
of <em>R</em>, using dates of onset of symptoms and information on the serial
interval distribution. It is a simpler but less flexible version of the
model by Cori et al (2013, AJE 178: 1505â€“1512) implemented in
<a href="https://cran.r-project.org/web/packages/EpiEstim/index.html"><code>EpiEstim</code></a>.</p>

<p><br></p>

<p>Briefly, <code>earlyR</code> uses a simple model describing incidence on a given
day as a Poisson process determined by a global force of infection on
that day:
<em>x</em><sub><em>t</em></sub> ∼ 𝒫(<em>λ</em><sub><em>t</em></sub>)</p>

<p>where <em>x</em><sub><em>t</em></sub> is the incidence (based on symptom onset) on day
<em>t</em> and <em>λ</em><sub><em>t</em></sub> is the force of infection. Noting <em>R</em> the
reproduction number and <em>w</em>() the discrete serial interval distribution,
we have:</p>

<p>$$
\lambda_t = R * \sum_{s=1}^t x_s w(t - s)
$$</p>

<p>The likelihood (probability of observing the data given the model and
parameters) is defined as a function of <em>R</em>:</p>

<p>$$
\mathcal{L}(x)  = p(x | R) = \prod_{t=1}^T F_{\mathcal{P}}(x_t, \lambda_t)
$$</p>

<p>where <em>F</em><sub>𝒫</sub> is the Poisson probability mass function.</p>

<h3 id="estimating-the-serial-interval-from-older-data">Estimating the serial interval from older data</h3>

<p>As current data are insufficient to estimate the serial interval
distribution, some colleague recommends using data from a past outbreak
stored in the <code>outbreaks</code> package, as the dataset <code>ebola_sim_clean</code>.
Load this dataset, and create a new <code>epicontacts</code> object as before,
without plotting it (it is a much larger dataset). Store the new object
as <code>old_evd</code>; the output should look like:</p>

<pre><code class="language-r">old_evd
## 
## /// Epidemiological Contacts //
## 
##   // class: epicontacts
##   // 5,829 cases in linelist; 3,800 contacts;  directed 
## 
##   // linelist
## 
## # A tibble: 5,829 x 9
##    id     generation date_of_infection date_of_onset date_of_hospitalisat~
##  * &lt;chr&gt;       &lt;int&gt; &lt;date&gt;            &lt;date&gt;        &lt;date&gt;               
##  1 d1fafd          0 NA                2014-04-07    2014-04-17           
##  2 53371b          1 2014-04-09        2014-04-15    2014-04-20           
##  3 f5c3d8          1 2014-04-18        2014-04-21    2014-04-25           
##  4 6c286a          2 NA                2014-04-27    2014-04-27           
##  5 0f58c4          2 2014-04-22        2014-04-26    2014-04-29           
##  6 49731d          0 2014-03-19        2014-04-25    2014-05-02           
##  7 f9149b          3 NA                2014-05-03    2014-05-04           
##  8 881bd4          3 2014-04-26        2014-05-01    2014-05-05           
##  9 e66fa4          2 NA                2014-04-21    2014-05-06           
## 10 20b688          3 NA                2014-05-05    2014-05-06           
## # ... with 5,819 more rows, and 4 more variables: date_of_outcome &lt;date&gt;,
## #   outcome &lt;fct&gt;, gender &lt;fct&gt;, hospital &lt;fct&gt;
## 
##   // contacts
## 
## # A tibble: 3,800 x 3
##    from   to     source 
##  * &lt;chr&gt;  &lt;chr&gt;  &lt;fct&gt;  
##  1 d1fafd 53371b other  
##  2 cac51e f5c3d8 funeral
##  3 f5c3d8 0f58c4 other  
##  4 0f58c4 881bd4 other  
##  5 8508df 40ae5f other  
##  6 127d83 f547d6 funeral
##  7 f5c3d8 d58402 other  
##  8 20b688 d8a13d other  
##  9 2ae019 a3c8b8 other  
## 10 20b688 974bc1 other  
## # ... with 3,790 more rows
</code></pre>

<p>The function <code>get_pairwise</code> can be used to extract pairwise features of
contacts based on attributes of the linelist. For instance, it could be
used to test for assortativity, but also to compute delays between
connected cases. Here, we use it to extract the serial interval:</p>

<pre><code class="language-r">old_si &lt;- get_pairwise(old_evd, &quot;date_of_onset&quot;)
summary(old_si)
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##    1.00    5.00    9.00   11.06   15.00   99.00    1684
old_si &lt;- na.omit(old_si)
summary(old_si)
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    1.00    5.00    9.00   11.06   15.00   99.00
hist(old_si, xlab = &quot;Days after symptom onset&quot;, ylab = &quot;Frequency&quot;,
     main = &quot;Serial interval (empirical distribution)&quot;,
     col = &quot;grey&quot;, border = &quot;white&quot;)
</code></pre>

<p><img src="practical-ebola-response_files/figure-markdown_github/old_si-1.png" alt="" /></p>

<p><font class="question">What do you think of this distribution?</font>
Make the adjustments you deem necessary, and then use the function
<code>fit_disc_gamma</code> from the package <code>epitrix</code> to fit a discretised Gamma
distribution to these data. Your results should approximately look like:</p>

<pre><code class="language-r">si_fit &lt;- fit_disc_gamma(old_si)
si_fit
## $mu
## [1] 11.48373
## 
## $cv
## [1] 0.6429561
## 
## $sd
## [1] 7.383534
## 
## $ll
## [1] -6905.588
## 
## $converged
## [1] TRUE
## 
## $distribution
## A discrete distribution
##   name: gamma
##   parameters:
##     shape: 2.41900859135364
##     scale: 4.74728799288241
</code></pre>

<p>Now that you know how to parametrise a discretised Gamma distribution
matching previous data on the serial interval, create this distribution
using the function <code>distcrete</code> from the similarly named package. Specify
make sure you use daily intervals for the discretisation, and use
<code>w = 0</code> to indicate dates should be floored to the day. Store the ouput
in an object called <code>si</code>. Your results should look like:</p>

<pre><code>## Warning: package 'distcrete' was built under R version 3.4.4
si
## A discrete distribution
##   name: gamma
##   parameters:
##     shape: 2.41900859135364
##     scale: 4.74728799288241

## look at the fit
hist(old_si, xlab = &quot;Days after symptom onset&quot;, ylab = &quot;Frequency&quot;,
     main = &quot;Serial interval: fit to data&quot;, col = &quot;grey&quot;, border = &quot;white&quot;,
     nclass = 30, ylim = c(0, 0.07), prob = TRUE)
points(0:60, si$d(0:60), col = &quot;#9933ff&quot;, pch = 20)
points(0:60, si$d(0:60), col = &quot;#9933ff&quot;, type = &quot;l&quot;, lty = 2)
</code></pre>

<p><img src="practical-ebola-response_files/figure-markdown_github/si-1.png" alt="" /></p>

<p><font class="question">Would you trust this estimation of the generation
time?</font> <font class="question">How would you compare it to actual
estimates from the West African EVD outbreak (WHO Ebola Response Team
(2014) NEJM 371:1481â€“1495) with a mean of 15.3 days and a standard
deviation 9.3 days?</font></p>

<h3 id="estimation-of-r-sub-0-sub">Estimation of <em>R</em><sub>0</sub></h3>

<p>Using the estimates of the mean and standard deviation of the serial
interval you just obtained, use the function <code>get_R</code> to estimate the
reproduction number, specifying a maximum R of 10 (see ?<code>get_R</code>) and
store the result in a new object <code>R</code>:</p>

<p>You can visualise the results as follows:</p>

<pre><code class="language-r">R
## 
## /// Early estimate of reproduction number (R) //
##  // class: earlyR, list
## 
##  // Maximum-Likelihood estimate of R ($R_ml):
## [1] 1.811812
## 
## 
##  // $lambda:
##   0.04088711 0.05343783 0.06188455 0.06668495 0.06850099 0.0680082...
## 
##  // $dates:
## [1] &quot;2017-10-11&quot; &quot;2017-10-12&quot; &quot;2017-10-13&quot; &quot;2017-10-14&quot; &quot;2017-10-15&quot;
## [6] &quot;2017-10-16&quot;
## ...
## 
##  // $si (serial interval):
## A discrete distribution
##   name: gamma
##   parameters:
##     shape: 2.41900859135364
##     scale: 4.74728799288241
plot(R)
</code></pre>

<p><img src="practical-ebola-response_files/figure-markdown_github/plot-r-1.png" alt="" /></p>

<pre><code class="language-r">plot(R, &quot;lambdas&quot;)
abline(v = linelist$onset, lty = 2)
</code></pre>

<p><img src="practical-ebola-response_files/figure-markdown_github/plot-r-2.png" alt="" /></p>

<p>The first figure shows the distribution of likely values of <em>R</em>, and the
Maximum-Likelihood (ML) estimation. The second figure shows the global
force of infection over time, with dashed bars indicating dates of onset
of the cases.</p>

<p><font class="question">Interpret these results: what do you make of the
reproduction number?What does it reflect? Based on the last part of the
epicurve, some colleagues suggest that incidence is going down and the
outbreak may be under control. What is your opinion on this?</font></p>

<h2 id="short-term-forecasting">Short-term forecasting</h2>

<p>The function <code>project</code> from the package <code>projections</code> can be used to
simulate plausible epidemic trajectories by simulating daily incidence
using the same branching process as the one used to estimate
<em>R</em><sub>0</sub> in <code>earlyR</code>. All that is needed is one or several values
of <em>R</em><sub>0</sub> and a serial interval distribution, stored as a
<code>distcrete</code> object.</p>

<p>Here, we illustrate how we can simulate 5 random trajectories using a
fixed value of $R_0 = $1.81, the ML estimate of <em>R</em><sub>0</sub>:</p>

<pre><code class="language-r">library(projections)
## Warning: package 'projections' was built under R version 3.4.4
project(i, R = R$R_ml, si = si, n_sim = 5, n_days = 10, R_fix_within = TRUE)
## 
## /// Incidence projections //
## 
##   // class: projections, matrix
##   // 10 dates (rows); 5 simulations (columns)
## 
##  // first rows/columns:
##            [,1] [,2] [,3] [,4] [,5]
## 2017-10-28    0    2    0    0    0
## 2017-10-29    1    0    1    1    0
## 2017-10-30    1    2    0    4    1
## 2017-10-31    0    1    0    0    0
##  .
##  .
##  .
## 
##  // dates:
##  [1] &quot;2017-10-28&quot; &quot;2017-10-29&quot; &quot;2017-10-30&quot; &quot;2017-10-31&quot; &quot;2017-11-01&quot;
##  [6] &quot;2017-11-02&quot; &quot;2017-11-03&quot; &quot;2017-11-04&quot; &quot;2017-11-05&quot; &quot;2017-11-06&quot;
</code></pre>

<p>Using the same principle, generate 1,000 trajectories for the next 2
weeks, using a range of plausible values of <em>R</em><sub>0</sub>. Note that
you can use <code>sample_R</code> to obtain these values from your <code>earlyR</code> object.
Store your results in an object called <code>proj</code>. Plotting the results
should give something akin to:</p>

<pre><code class="language-r">plot(proj, c(.1,.9))
</code></pre>

<p><img src="practical-ebola-response_files/figure-markdown_github/project-1.png" alt="" /></p>

<p>Interpret the following summary:</p>

<pre><code class="language-r">apply(proj, 1, summary)
##         2017-10-28 2017-10-29 2017-10-30 2017-10-31 2017-11-01 2017-11-02
## Min.         0.000      0.000      0.000      0.000      0.000      0.000
## 1st Qu.      0.000      0.000      0.000      0.000      1.000      1.000
## Median       1.000      1.000      1.000      1.000      1.000      1.000
## Mean         1.403      1.457      1.518      1.494      1.651      1.771
## 3rd Qu.      2.000      2.000      2.000      2.000      2.000      3.000
## Max.         7.000      6.000      8.000     10.000     10.000     13.000
##         2017-11-03 2017-11-04 2017-11-05 2017-11-06 2017-11-07 2017-11-08
## Min.         0.000      0.000      0.000       0.00      0.000      0.000
## 1st Qu.      1.000      1.000      1.000       1.00      1.000      1.000
## Median       2.000      2.000      2.000       2.00      2.000      2.000
## Mean         1.905      2.046      2.313       2.42      2.663      2.942
## 3rd Qu.      3.000      3.000      3.000       3.00      4.000      4.000
## Max.        12.000     11.000     25.000      26.00     27.000     20.000
##         2017-11-09 2017-11-10
## Min.         0.000      0.000
## 1st Qu.      1.000      1.000
## Median       2.000      3.000
## Mean         3.144      3.606
## 3rd Qu.      4.000      5.000
## Max.        25.000     27.000
apply(proj, 1, function(x) mean(x&gt;0))
## 2017-10-28 2017-10-29 2017-10-30 2017-10-31 2017-11-01 2017-11-02 
##      0.742      0.742      0.741      0.738      0.781      0.771 
## 2017-11-03 2017-11-04 2017-11-05 2017-11-06 2017-11-07 2017-11-08 
##      0.808      0.808      0.809      0.816      0.824      0.850 
## 2017-11-09 2017-11-10 
##      0.859      0.877
</code></pre>

<p><font class="question">According to these results, what are the chances
that more cases will appear in the near
future?</font><font class="question">Is this outbreak being brought
under control?</font> <font class="question">Would you recommend scaling
up / down the response?</font></p>

<h2 id="follow-up">Follow-up…</h2>

<p>For a follow-up on this outbreak, have a look at the <a href="../simulated-evd-reconstruction">second
part</a> of this simulated response, which
includes a data update, genetic sequences, and the use of outbreak
reconstruction tools.</p>

<h1 id="about-this-document">About this document</h1>

<h2 id="contributors">Contributors</h2>

<ul>
<li>Thibaut Jombart: initial version</li>
</ul>

<p>Contributions are welcome via <a href="https://github.com/reconhub/learn/pulls">pull
requests</a>. The source file is
hosted on
<a href="https://github.com/reconhub/learn/blob/master/content/post/2017-11-21-sim-ebola-response-early.Rmd">github</a>.</p>

<h2 id="legal-stuff">Legal stuff</h2>

<p><strong>License</strong>: <a href="https://creativecommons.org/licenses/by/3.0/">CC-BY</a>
<strong>Copyright</strong>: Thibaut Jombart, 2017</p>
    
                </div>
            </section>
        
            <footer class="post-full-footer">
              <section class="author-card">
                <img class="author-profile-image" src="https://reconlearn-ld.netlify.com/img/user.png" alt="Author" />
                <section class="author-card-content">
                        <span class="post-card-author">
                                <a href="/authors/thibaut-jombart.html">Thibaut Jombart</a><br><a href="/authors/finlay-campbell.html">Finlay Campbell</a><br>
                              </span>
                </section>
              </section>
            </footer>
        </article>
    
    
    

<div id="disqus_thread"></div>
<script>




var disqus_config = function () {
this.page.url = "https:\/\/reconlearn-ld.netlify.com\/post\/simulated-evd-early.html";  
this.page.identifier = "https:\/\/reconlearn-ld.netlify.com\/post\/simulated-evd-early.html"; 
};

(function() { 
var d = document, s = d.createElement('script');
s.src = 'https://itsalocke.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  </div>
</main>


<aside class="read-next outer">
  <div class="inner">
    <div class="read-next-feed">      
      
<article class="read-next-card" style="background-color: #090a0b;">
    <header class="read-next-card-header">
        <small class="read-next-card-header-sitetitle">&mdash; RECON learn &mdash;</small>
        
    </header>
    <div class="read-next-divider"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 14.5s2 3 5 3 5.5-2.463 5.5-5.5S21 6.5 18 6.5c-5 0-7 11-12 11C2.962 17.5.5 15.037.5 12S3 6.5 6 6.5s4.5 3.5 4.5 3.5"/></svg>
    </div>

    <div class="read-next-card-content">
      
        <ul>
          <li><a href="https://reconlearn-ld.netlify.com/post/lecture-phylogenetics.html">Introduction to phylogenetics</a></li>            
        
          <li><a href="https://reconlearn-ld.netlify.com/post/basicvbdmodelling.html">Basic Concepts on Vector Borne Disease Modelling</a></li>            
        
          <li><a href="https://reconlearn-ld.netlify.com/post/practical-ebola-reconstruction.html">Ebola simulation part 2: outbreak reconstruction</a></li>            
        
          <li><a href="https://reconlearn-ld.netlify.com/post/practical-vbd.html">VBD: building a simple model for Zika</a></li>            
        </ul>
    </div>
    <footer class="read-next-card-footer">
      
    </footer>
</article>


      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://reconlearn-ld.netlify.com/post/outbreakstatsprimer.html">
      <div class="post-card-image" style="background-image: url(https://reconlearn-ld.netlify.com/img/highres/stats-notebook.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://reconlearn-ld.netlify.com/post/outbreakstatsprimer.html">
          <header class="post-card-header">
              
              <h2 class="post-card-title">A primer on statistical outbreak analysis</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p>This short lecture gives a primer on some methodological aspects of outbreak analysis. It includes content on the estimation of key delays (e.g. incubation period, serial interval) and the characterisation of the underlying distributions, the estimation of growth rates, doubling times, of the basic reproduction number and simple short-term forecasting.
Slides Click on the image below to access the slides:
  
About this document Contributors  Thibaut Jombart: initial version  Contributions are welcome via pull requests. ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://reconlearn-ld.netlify.com/img/user.png" alt="Author" />
          <span class="post-card-author"><a href="/">Thibaut Jombart</a></span>
      </footer>
    </div>
</article>
      
      
      <article class="post-card post"> 
    
    <a class="post-card-image-link" href="https://reconlearn-ld.netlify.com/post/practical-compartmental-ebola.html">
      <div class="post-card-image" style="background-image: url(https://reconlearn-ld.netlify.com/img/highres/ebola-green.jpg)"></div>
    </a>
    

    <div class="post-card-content">
      <a class="post-card-content-link" href="https://reconlearn-ld.netlify.com/post/practical-compartmental-ebola.html">
          <header class="post-card-header">
              
              <h2 class="post-card-title">Ebola: building few models for Ebola</h2>
          </header>
          <section class="post-card-excerpt">
              
                <p>This practical aims to illustrate the basics of Ebola modelling using R, with an emphasis on how the method works.
We will start with a basic model for Ebola. We will then illustrate how to account for an evolving context, e.g. implementation of control measures. Finally, we will explore basic principle of model fitting.
Core Concepts From the previous lecture, we will further develop these concepts:
 Compartmental models Flow diagrams and writing down a model Natural history of Ebola Control strategies Introduction to model fitting  Required packages install. ...  </p>
              
          </section>
      </a>

      <footer class="post-card-meta">
          <img class="author-profile-image" src="https://reconlearn-ld.netlify.com/img/user.png" alt="Author" />
          <span class="post-card-author"><a href="/">Pierre Nouvellet &amp; Zulma Cucunuba</a></span>
      </footer>
    </div>
</article>
      
    </div>
  </div>
</aside>

<div class="floating-header">
  <div class="floating-header-logo">
    <a href="https://reconlearn-ld.netlify.com/">
      <img src="https://reconlearn-ld.netlify.com/img/logo/learnBlueAndWhite.png" alt="" />
    </a>
  </div>
  <span class="floating-header-divider">&mdash;</span>
  <div class="floating-header-title">Ebola simulation part 1: early outbreak assessment</div>
  <div class="floating-header-share">
    <div class="floating-header-share-label">Share this <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
     <path d="M7.5 15.5V4a1.5 1.5 0 1 1 3 0v4.5h2a1 1 0 0 1 1 1h2a1 1 0 0 1 1 1H18a1.5 1.5 0 0 1 1.5 1.5v3.099c0 .929-.13 1.854-.385 2.748L17.5 23.5h-9c-1.5-2-5.417-8.673-5.417-8.673a1.2 1.2 0 0 1 1.76-1.605L7.5 15.5zm6-6v2m-3-3.5v3.5m6-1v2"/></svg>
    </div>
    
    <a class="floating-header-share-tw" href="https://twitter.com/share?text=Ebola%20simulation%20part%201%3a%20early%20outbreak%20assessment&amp;url=https%3a%2f%2freconlearn-ld.netlify.com%2fpost%2fsimulated-evd-early.html"
          onclick="window.open(this.href, 'share-twitter', 'width=550,height=235');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M30.063 7.313c-.813 1.125-1.75 2.125-2.875 2.938v.75c0 1.563-.188 3.125-.688 4.625a15.088 15.088 0 0 1-2.063 4.438c-.875 1.438-2 2.688-3.25 3.813a15.015 15.015 0 0 1-4.625 2.563c-1.813.688-3.75 1-5.75 1-3.25 0-6.188-.875-8.875-2.625.438.063.875.125 1.375.125 2.688 0 5.063-.875 7.188-2.5-1.25 0-2.375-.375-3.375-1.125s-1.688-1.688-2.063-2.875c.438.063.813.125 1.125.125.5 0 1-.063 1.5-.25-1.313-.25-2.438-.938-3.313-1.938a5.673 5.673 0 0 1-1.313-3.688v-.063c.813.438 1.688.688 2.625.688a5.228 5.228 0 0 1-1.875-2c-.5-.875-.688-1.813-.688-2.75 0-1.063.25-2.063.75-2.938 1.438 1.75 3.188 3.188 5.25 4.25s4.313 1.688 6.688 1.813a5.579 5.579 0 0 1 1.5-5.438c1.125-1.125 2.5-1.688 4.125-1.688s3.063.625 4.188 1.813a11.48 11.48 0 0 0 3.688-1.375c-.438 1.375-1.313 2.438-2.563 3.188 1.125-.125 2.188-.438 3.313-.875z"/></svg>
      </a>
      <a class="floating-header-share-fb" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2freconlearn-ld.netlify.com%2fpost%2fsimulated-evd-early.html"
          onclick="window.open(this.href, 'share-facebook','width=580,height=296');return false;">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19 6h5V0h-5c-3.86 0-7 3.14-7 7v3H8v6h4v16h6V16h5l1-6h-6V7c0-.542.458-1 1-1z"/></svg>
      </a>
  </div>

  <progress class="progress" value="0">
    <div class="progress-container">
      <span class="progress-bar"></span>
    </div>
  </progress>
</div>



<footer class="site-footer outer">
  <div class="site-footer-content inner">
    <section class="copyright" style="line-height: 1.3em;">
      <a href="/">RECON</a> ©2017 Thibaut Jombart <br>
      <span style="font-size: 0.8em; color: #555;">Hugo port of <a href="https://github.com/TryGhost/Casper">Casper 2.1.7</a> by <a href="https://www.telematika.org">EM</a></span>
    </section>
    <nav class="site-footer-nav">
        <a href="/">Latest Posts</a>
        
        <a href="https://twitter.com/teebzr" target="_blank" rel="noopener">Twitter</a>
        <a href="https://github.com/reconhub/learn" target="_blank" rel="noopener">Github</a>
        
        
    </nav>  
  </div>
</footer>

</div>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script type="text/javascript" src="//code.jquery.com/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="https://reconlearn-ld.netlify.com/js/jquery.fitvids.js"></script>

<script>hljs.initHighlightingOnLoad();</script>



    <script>





$(document).ready(function () {
    
    var $postContent = $(".post-full-content");
    $postContent.fitVids();
    

    var progressBar = document.querySelector('progress');
    var header = document.querySelector('.floating-header');
    var title = document.querySelector('.post-full-title');

    var lastScrollY = window.scrollY;
    var lastWindowHeight = window.innerHeight;
    var lastDocumentHeight = $(document).height();
    var ticking = false;

    function onScroll() {
        lastScrollY = window.scrollY;
        requestTick();
    }

    function onResize() {
        lastWindowHeight = window.innerHeight;
        lastDocumentHeight = $(document).height();
        requestTick();
    }

    function requestTick() {
        if (!ticking) {
            requestAnimationFrame(update);
        }
        ticking = true;
    }

    function update() {
        var trigger = title.getBoundingClientRect().top + window.scrollY;
        var triggerOffset = title.offsetHeight + 35;
        var progressMax = lastDocumentHeight - lastWindowHeight;

        
        if (lastScrollY >= trigger + triggerOffset) {
            header.classList.add('floating-active');
        } else {
            header.classList.remove('floating-active');
        }

        progressBar.setAttribute('max', progressMax);
        progressBar.setAttribute('value', lastScrollY);

        ticking = false;
    }

    window.addEventListener('scroll', onScroll, {passive: true});
    window.addEventListener('resize', onResize, false);

    update();
});
</script>
</body></html>
